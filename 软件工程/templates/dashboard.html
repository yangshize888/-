<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>å•è¯å­¦ä¹ é¡µé¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .word-box {
            margin-top: 40px;
            padding: 30px;
            border: 2px solid #007bff;
            border-radius: 10px;
            text-align: center;
            background-color: #f8f9fa;
        }
        .word-text {
            font-size: 2rem;
            font-weight: bold;
            color: #343a40;
        }
        .date-picker {
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <!-- é¡¶éƒ¨æ  -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h4>æ¬¢è¿è¿›å…¥èƒŒå•è¯ç³»ç»Ÿï¼Œç”¨æˆ·IDï¼š<span id="userId">{{ user_id }}</span></h4>
            </div>
            <div>
                <button class="btn btn-outline-secondary me-2" onclick="switchUser()">åˆ‡æ¢è´¦æˆ·</button>
                <button class="btn btn-outline-danger" onclick="logout()">ç™»å‡º</button>
            </div>
        </div>

        <p>ä½ å¯ä»¥å¼€å§‹æ·»åŠ ã€ç»ƒä¹ ã€å¤ä¹ å•è¯å•¦ï¼</p>

        <!-- æ—¥æœŸé€‰æ‹© -->
        <div class="mb-3">
            <label for="calendar" class="form-label">ğŸ“… å­¦ä¹ æ—¥æœŸï¼š</label>
            <input type="date" class="form-control" id="calendar" onchange="onDateChange(this.value)">
        </div>

        <!-- å½“å‰å•è¯å±•ç¤º -->
        <div class="word-box" id="wordBox">
    <div class="word-text" id="currentWord">åŠ è½½ä¸­...</div>
    <div class="text-muted mt-2" id="currentMeaning">é‡Šä¹‰åŠ è½½ä¸­...</div>
</div>

        <!-- æ“ä½œæŒ‰é’® -->
    <div class="mt-3 text-center d-flex justify-content-center">
    <button class="btn btn-outline-success me-2" onclick="markRemembered()">æˆ‘è®°ä½äº†</button>
    <button class="btn btn-outline-warning" onclick="markMistake()">æˆ‘æ²¡è®°ä½</button>
</div>

        
       <!-- æ“ä½œæŒ‰é’® -->
    <div class="mt-4 text-center d-flex justify-content-center">
         <button class="btn btn-primary me-2" onclick="nextWord()">ä¸‹ä¸€ä¸ªå•è¯</button>
         <button class="btn btn-success me-2" onclick="addFavorite()">æ·»åŠ åˆ°æ”¶è—å¤¹</button>
         <button class="btn btn-danger me-2" onclick="markMistake()">æ ‡è®°ä¸ºé”™è¯¯</button>

    <!-- åˆ‡æ¢ä¹¦ç±æŒ‰é’® -->
         <button class="btn btn-info" onclick="switchBook()">åˆ‡æ¢ä¹¦ç±</button>
    </div>
 

        <!-- æç¤ºæ¶ˆæ¯ -->
        <div class="mt-3 text-center text-muted" id="messageBox"></div>
    </div>

    <script>
        let currentWord = "";
        let currentBook = "CET4";  // åˆå§‹ä¹¦ç±
        const userId = document.getElementById("userId").textContent;

        // è‡ªåŠ¨è®¾ç½®å½“å‰æ—¥æœŸ
        function setTodayDate() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            document.getElementById("calendar").value = `${yyyy}-${mm}-${dd}`;
        }

        async function loadWord() {
    const res = await fetch(`/api/next_word?user_id=${userId}`);
    const data = await res.json();
    if (data.status === "ok" && data.word) {
        currentWord = data.word;
        document.getElementById('currentWord').textContent = data.word;
        document.getElementById('currentMeaning').textContent = data.meaning || "æš‚æ— é‡Šä¹‰";
    } else {
        document.getElementById('currentWord').textContent = "ğŸ‰ å½“å‰è¯ä¹¦å·²å­¦å®Œï¼";
        document.getElementById('currentMeaning').textContent = "";
    }
}

        async function nextWord() {
            await loadWord();
            showMessage("å·²åŠ è½½ä¸‹ä¸€ä¸ªå•è¯");
        }


        async function markRemembered() {
    if (!currentWord) return;
    await fetch(`/api/remember?user_id=${userId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ word: currentWord })
    });
    showMessage(`"${currentWord}" å·²æ ‡è®°ä¸ºè®°ä½`);
    await loadWord();  // è‡ªåŠ¨åŠ è½½ä¸‹ä¸€ä¸ª
}


        async function addFavorite() {
            if (!currentWord) return;
            await fetch(`/api/favorite?user_id=${userId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ word: currentWord })
            });
            showMessage(`å·²å°† "${currentWord}" åŠ å…¥æ”¶è—å¤¹`);
        }

        async function markMistake() {
            if (!currentWord) return;
            await fetch(`/api/mistake?user_id=${userId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ word: currentWord })
            });
            showMessage(`å·²å°† "${currentWord}" æ ‡è®°ä¸ºé”™è¯¯`);
        }

        // åˆ‡æ¢ä¹¦ç±
        async function switchBook() {
            const newBook = currentBook === "CET4" ? "CET6" : "CET4"; // åˆ‡æ¢ä¹¦ç±ç±»å‹
            currentBook = newBook;
            // æ›´æ–°å‰ç«¯æŒ‰é’®çš„æ˜¾ç¤º
            showMessage(`å·²åˆ‡æ¢åˆ° ${newBook} è¯ä¹¦`);
            await fetch(`/api/set_book`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ book: newBook })
            });
            await loadWord();  // åˆ‡æ¢ååŠ è½½æ–°ä¹¦ä¸­çš„å•è¯
        }

        function showMessage(msg) {
            document.getElementById('messageBox').textContent = msg;
        }

        // å¤„ç†æ—¥æœŸå˜åŒ–
        function onDateChange(date) {
            showMessage(`ä½ é€‰æ‹©äº†æ—¥æœŸï¼š${date}`);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è®¾ç½®æ—¥æœŸ
        window.onload = function() {
            setTodayDate(); // è®¾ç½®ä»Šå¤©æ—¥æœŸ
            loadWord(); // åŠ è½½é»˜è®¤å•è¯
        };
    </script>
</body>
</html>
